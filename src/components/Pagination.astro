---
import IconFirstPage from "@assets/svgs/chevron-left-first.svg"
import IconLastPage from "@assets/svgs/chevron-right-last.svg"
import IconPreviousPage from "@assets/svgs/chevron-left.svg"
import IconNextPage from "@assets/svgs/chevron-right.svg"

export interface Props {
	prevUrl?: string
	currentUrl: string
	nextUrl?: string
	currentPage: number
	lastPage: number
}

const { prevUrl, currentUrl, nextUrl, currentPage, lastPage } = Astro.props as Props
const firstPage = 1
const regexpPageNumber = /\/[0-9]+(?=[^/]*$)/g
const maxPages = 5
const pageList: number[] = Array.from({ length: lastPage }, (_: number, i) => i + 1)
let paginationLeft: number[] = []
let paginationRight: number[] = []
// reduce the list of pages that are displayed for pagination to maxPages (previous and next)
pageList.forEach((i) => {
	if (0 < currentPage - i && currentPage - i <= maxPages) {
		paginationLeft.push(i)
	}
	if (0 < i - currentPage && i - currentPage <= maxPages) {
		paginationRight.push(i)
	}
})
const paginationLeftCount = paginationLeft.length
const paginationRightCount = paginationRight.length
// pad arrays with 0s to balance both sides with same maxPages count. Zero entries will be hidden
if (paginationLeft.length < maxPages) {
	paginationLeft = [...Array.from({ length: maxPages }, () => 0), ...paginationLeft]
	while (paginationLeft.length > maxPages) {
		paginationLeft.shift()
	}
}
if (paginationRight.length < maxPages) {
	paginationRight = [...paginationRight, ...Array.from({ length: maxPages }, () => 0)].slice(
		0,
		maxPages
	)
}
// build pagination list to be displayed
const paginationList: number[] = [...paginationLeft, currentPage, ...paginationRight]
---

<nav
	class="mx-auto flex items-center justify-center gap-2 p-0 py-6"
	class:list={[
		"[&>a:nth-child(3)]:hidden sm:[&>a:nth-child(3):not([data-page='0'])]:block",
		{
			"[&>a:nth-child(4)]:hidden sm:[&>a:nth-child(4):not([data-page='0'])]:block":
				paginationLeftCount >= 4 && paginationRightCount > 0
		},
		{
			"[&>a:nth-child(5)]:hidden sm:[&>a:nth-child(5):not([data-page='0'])]:block":
				paginationLeftCount >= 3 && paginationRightCount > 1
		},
		{
			"[&>a:nth-child(11)]:hidden sm:[&>a:nth-child(11):not([data-page='0'])]:block":
				paginationRightCount >= 3 && paginationLeftCount > 1
		},
		{
			"[&>a:nth-child(12)]:hidden sm:[&>a:nth-child(12):not([data-page='0'])]:block":
				paginationRightCount >= 4 && paginationLeftCount > 0
		},
		"[&>a:nth-child(13)]:hidden sm:[&>a:nth-child(13):not([data-page='0'])]:block"
	]}
>
	{
		currentPage === firstPage ? (
			<span
				class="border-grayish-300 text-grayish-300 rounded-sm border-2 p-1 text-sm uppercase"
				aria-hidden="true"
			>
				<span class="sr-only">First page</span>
				<IconFirstPage class="size-5" />
			</span>
		) : (
			<a
				class="border-grayish-500 rounded-sm border-2 p-1 text-sm uppercase no-underline hover:shadow-md"
				href={prevUrl?.replace(regexpPageNumber, "")}
				aria-label="First Page"
			>
				<span class="sr-only">First page</span>
				<IconFirstPage class="size-5" />
			</a>
		)
	}
	{
		!prevUrl ? (
			<span
				class="border-grayish-300 text-grayish-300 rounded-sm border-2 p-1 text-sm uppercase"
				aria-hidden="true"
			>
				<span class="sr-only">Previous page</span>
				<IconPreviousPage class="size-5" />
			</span>
		) : (
			<a
				class="border-grayish-500 rounded-sm border-2 p-1 text-sm uppercase no-underline hover:shadow-md"
				href={prevUrl}
				aria-label="Previous Page"
			>
				<span class="sr-only">Previous page</span>
				<IconPreviousPage class="size-5" />
			</a>
		)
	}

	{
		paginationList.map((i) =>
			i === currentPage ? (
				<span class="border-grayish-300 text-grayish-300 min-w-6 rounded-sm border-2 p-1 text-center text-sm uppercase">
					{i}
				</span>
			) : (
				<a
					class="border-grayish-500 min-w-6 rounded-sm border-2 p-1 text-center text-sm uppercase no-underline hover:shadow-md data-[page='0']:hidden"
					data-page={i}
					href={
						i === 1
							? currentUrl.replace(regexpPageNumber, "")
							: currentUrl.match(regexpPageNumber)
								? currentUrl.replace(regexpPageNumber, `/${i}`)
								: `${currentUrl}/${i}`
					}
				>
					{i}
				</a>
			)
		)
	}

	{
		!nextUrl ? (
			<span
				class="border-grayish-300 text-grayish-300 rounded-sm border-2 p-1 text-sm uppercase"
				aria-hidden="true"
			>
				<span class="sr-only">Next page</span>
				<IconNextPage class="size-5" />
			</span>
		) : (
			<a
				class="border-grayish-500 rounded-sm border-2 p-1 text-sm uppercase no-underline hover:shadow-md"
				href={nextUrl}
				aria-label="Next Page"
			>
				<span class="sr-only">Next page</span>
				<IconNextPage class="size-5" />
			</a>
		)
	}
	{
		currentPage === lastPage ? (
			<span
				class="border-grayish-300 text-grayish-300 rounded-sm border-2 p-1 text-sm uppercase"
				aria-hidden="true"
			>
				<span class="sr-only">Last page</span>
				<IconLastPage class="size-5" />
			</span>
		) : (
			<a
				class="border-grayish-500 rounded-sm border-2 p-1 text-sm uppercase no-underline hover:shadow-md"
				href={nextUrl?.replace(regexpPageNumber, `/${lastPage}`)}
				aria-label="Last Page"
			>
				<span class="sr-only">Last page</span>
				<IconLastPage class="size-5" />
			</a>
		)
	}
</nav>
